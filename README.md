# fcx_ce

This repository is used to analyze cryptic exons on sequencing reads from single cells. 
Specifically, sequencing reads are filtered by celltype and sample groups of interest, 
which were previously determined.

## Package installation

Packages required for this analysis are listed in the `requirements.txt` file. The `env.archived.yaml` file shows 
package versions used for the current analysis. Install packages using [Conda](https://docs.conda.io/projects/conda/en/stable/)
package manager.

## Input datasets

Input to the current analysis consists of BAM files generated 
by [cellranger count](https://www.10xgenomics.com/support/software/cell-ranger/latest/tutorials/cr-tutorial-ct). 
Ensure the following files are prepared in the input directory.

- `possorted_genome_bam.bam`
- `possorted_genome_bam.bam.bai`

## Snakemake

The current analysis uses Snakemake, which runs each step in a pipeline. All commands and configurations
are designed to be executed within a Snakemake pipeline.

## Configuration

Configure analysis options using the `config.yaml` file, as demonstrated below:

### Sampletable

The following keys are configured in the sampletable:

- Unique sample identifiers. Set the `index_col` option to this column in the following key.
- Paths to input BAM files. Set the `bam_col` option to this column in the following key.
- Optional metadata columns. 
    - Set the `key_col` option to a column you want to aggregate sequencing reads by. 
    This is typically a column for sample groups.
    - Set the `celltype_col` option to a column for celltype annotation.

```yaml

# Path to sampletable
sampletable: "path/to/metadata.csv"
```

### Columns of interest

Your columns of interest in the sampletable are configured here. Refer to the 
following summary:

- `key_col`: Column for sample groups. Sequencing reads will be aggregated 
by sample group based on this column.
- `index_col`: Unique sample identifiers.
- `bam_col`: Paths to input BAM files. Ensure to use `possorted_genome_bam.bam` 
generated by `cellranger count`.
- `celltype_col`: Column for celltype annotation. Sequencing reads will be aggregated 
by celltype based on this column. Set this option to "" if you don't need celltype-
specific analysis.

```yaml

# Required column names
key_col: 'study_specific_disease_specific' # column for read aggregation
index_col: 'SampleID' # column for unique sample ID, aka index
bam_col: 'bam' # column for paths to bam files
celltype_col: 'celltype'  # column for celltype (leave '' to skip this option)
```

### All metadata columns

Oftentimes, the input sampletable contains many columns that are not necessarily informative 
at this point. This key configures column names that will be filtered for the current analysis.
Columns that are unspecified in this key will be removed to keep the analysis concise.


```yaml

# Metadata column for aggregating reads
all_cols: 
  - 'status'
  - 'study'
  - 'Genetics'
  - 'AgeDeath'
  - 'Disease'
  - 'BrainRegion'
  - 'Sex'
  - 'general_disease'
  - 'study_disease'
  - 'study_specific_disease_specific'
```

### Barcodes




```yaml

# Path to AnnData
adata:
  ExNeu1: "../../input/thalamus_excitatory/ExNeu1_FOR_DEG.h5ad"
  ExNeu2: "../../input/thalamus_excitatory/ExNeu2_FOR_DEG.h5ad"
```

### Paths to input and output directories

Set paths to directories containing input BAM files (`possorted_genome_bam.bam`) and all output files,
using the `bam_dir` and `outdir` keys.

```yaml

# Path to bam directory
bam_dir: '../../input/thalamus_excitatory/bam'

# Path to output directory
outdir: "results"
```

### Genes of interest

Sequencing reads for genes of interest will retain in the output BAM file. Specify 
the `genes` key to your genes of interest.

```yaml

# Genes of interest
genes:
  - 'STMN2'
  - 'UNC13A'
```
